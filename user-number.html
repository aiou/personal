<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>user-number</title>
	<link rel="stylesheet" href="css/index.css">
	<script src="js/jquery.min.js"></script>
    <script src="js/comment.js"></script>
</head>
<style>
			html{
	width: 100%;
	height: 100%;
	}
	body{
	width: 100%;
	height: 100%;
	background: url(image/big-bcg.png) no-repeat 0px 0px;
	background-size: 100%;
}
</style>
<body>
<div class="head">
		<div class="head-content">
			<h1 class="left"><img src="image/logo.png" alt=""></h1>
			<div class="right">
				<div>管理员</div>
				<div class="userss"></div>
			</div>
			<div class="right2">
				<img src="image/red-end.png" alt="" style="display:none;" class="red">
				<img src="image/gray-end.png" alt="" class="gray">
			</div>
		</div>
	</div>
 <div class="box">
		<div class="box-left">
			<a href="javascript:void(0)" class="a1">
			<div>
				<img src="image/page01.png" alt="">
				状态总览
				<span>		
				</span>
			</div>
		</a>
		<a href="javascript:void(0)" class="a2" >
			<div>
				<img src="image/page02.png" alt="">
				会议管理<span></span></div></a>
		<a href="javascript:void(0)" class="a3">
			<div>
				<img src="image/page03.png" alt="">
				会议室管理<span></span></div></a>
		<a href="javascript:void(0)" class="a4">
			<div>
				<img src="image/page04.png" alt="">
				部门管理<span></span></div></a>
		<a href="javascript:void(0)"class="a5" >
			<div>
				<img src="image/page05.png" alt="">
				用户账号<span class="show" style="display:block"></span></div></a>
		<a href="javascript:void(0)"class="a6" >
			<div>
				<img src="image/page06.png" alt="">
				硬件管理<span></span></div></a>
		<a href='javascript:void(0)' class="a7">
			<div>
				<img src="image/page07.png" alt="">
				修改密码<span></span></div>
		</a>
		</div>
		<div class="box-right">
		<div class="right-title">部门管理</div>
	<!-- 	<div class="right-about">
			<span class="right-about-span">所属部门</span>
			<input type="text">
			<span class="right-about-span">用户名称</span>
			<input type="text">
			<span class="span-about">查询</span>
		</div> -->
		<div class="user-content">
			<div class="content-box">
				<div class="ceshi">
					<ul class="li-heads">
							<li>账号名称</li>
							<li>账号别名</li>
							<li>用户名</li>
							<li>登录账号</li>
							<li>用户电话</li>
							<li>操作</li>
						</ul>
				</div>
				<div class="content-boxes"></div>
				<div class="pages">
						<span>第<span class="current-page"></span>页</span>
						<span>共<span class="page-count"></span>页</span>
						<span id="firstPage">首页</span>
						<span id="prev">上一页</span>
						<span id="next">下一页</span>
						<span id="lastPage">最后一页</span>
						<input type="text" class="page-num">
						<span id="page-jump">跳转</span>
	            </div>
			<!-- 		<ul class="li-head">
							<li class="accountnum">1212</li>
							<li class="accountalias">122</li>
							<li class="displayname">15454</li>
							<li class="username">15456</li>
							<li class="useremail">465465</li>
							<li class="description"><img src="image/bianji.png" alt=""></li>
						</ul>
				</div> -->
			</div>
		</div>

	</div>
</div>
<div class="bcgs"></div>
	<div class="forms">
		<div class="editors">编辑账号</div>
		<div class="form-box">
			<div>
				<span>账号别名</span>
				<span class="lefts">15151555</span>
				<span>昵称</span>
				<input class="lefts-right">
			</div>
			<div>
				<span>账号邮箱</span>
				<input type="text" class="admin-email">
			</div>
			<div>
				<span>联系电话</span>
				<input type="text" class="admin-tel">
			</div>
			<div>
				<span class="add-bgc">账号名称</span>
				<input type="text" placeholder="请输入账号名称" class="editor-user">
			</div>
			<div>
				<span class="add-bgc">注册密码</span>
				<input type="password" placeholder=" 请输入密码" class="editor-password">
			</div>
			<div>
				<span class="add-bgc">所属机构</span>
				<span class="lefts-department">111</span>
				<span class="add-bgcs">部门</span>
				<select name="" id="sls"class="department-input"></select>
				
			</div>
			<div style="position:relative">
				<span class="bottom-span">账号描述</span>
				<textarea name="" id="" cols="30" rows="10" placeholder=" 请输入描述信息，300字以内" class="description-input"></textarea>
				<span class="true">确定</span>
				<span class="cancel">取消</span>
			</div>
				
		</div>
	
</div>

<script>

	//获取location参数
function GetRequest() {

   var url = location.search; //获取url中"?"符后的字串

   var theRequest = new Object();

   if (url.indexOf("?") != -1) {

      var str = url.substr(1);

      strs = str.split("&");

      for(var i = 0; i < strs.length; i ++) {

         theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);

      }

   }
   return theRequest;

}
var Request = new Object();

Request = GetRequest();
var admin_id=Request.id
var admin_token=Request.name
var lefts=$(".box-left a")
var a=lefts.length
for (var i = 0; i<a; i++) {
	lefts.eq(i).click(function(){
		if($(this).hasClass('a7')){
			location.href='change-password.html?name='+admin_token+'&id='+admin_id;
		}
		else if($(this).hasClass('a1')){
			location.href='status.html?name='+admin_token+'&id='+admin_id;
		}
		else if($(this).hasClass('a2')){
			location.href='change-password.html?name='+admin_token+'&id='+admin_id;
		}
		else if($(this).hasClass('a3')){
			location.href='change-password.html?name='+admin_token+'&id='+admin_id;
		}
		else if($(this).hasClass('a4')){
			location.href='department-management.html?name='+admin_token+'&id='+admin_id;
		}
		else if($(this).hasClass('a5')){
			location.href='user-number.html?name='+admin_token+'&id='+admin_id;
		}
		else if($(this).hasClass('a6')){
			location.href='device-management.html?name='+admin_token+'&id='+admin_id;
		}
	})
}
$.ajax({
  type:"get",
  url:'https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/get-displayname?token='+admin_token,
  dataType:'json',
  success:function(data){
    $(".userss").html(data.data)
    console.log(data)
  }
})
// $.ajax({
// 	type:"get",
// 	url:'https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users?token='+admin_token,
// 	dataType:'json',
// 	success:function(data){
// 		console.log(data)
// 		var datas=data.data
// 		for (i=0;i<datas.length; i++){
// 		var	html=''
// 		 	html+='<div>';
// 			html+='<ul class="li-head">'
// 			html+='<li class="accountnum">'+datas[i].accountNum+'</li>';
// 			html+='<li class="accountalias">'+datas[i].accountAlias+'</li>';
// 			html+='<li class="displayname">'+datas[i].displayName+'</li>';
// 			html+='<li class="username">'+datas[i].userName+'</li>';
// 			html+='<li class="useremail">'+datas[i].userTel+'</li>';
// 			html+='<li class="description"><img src="image/bianji.png" class="sursors" alt=""></li>';
// 			html+='</ul>';
// 			html+='</div>';
// 			$(".content-box").append(html);
// 		};
		
// 	}
// })
function getJSONData(pn) {  
    //alert(pn)
    $.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users-count?token='+admin_token,function(data){
    	var totalCount=data.data.count;// 总记录数
    
    $.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users?token='+admin_token, function(data) {   
        var pageSize = 10; // 每页显示几条记录  
        var pageTotal = Math.ceil(totalCount / pageSize); // 总页数  
        var startPage = pageSize * (pn - 1);  
        var endPage = startPage + pageSize - 1;  
        var $ul = $(".content-boxes");  
        $ul.empty();  
        for (var i = 0; i < pageSize; i++) {  
            $ul.append('<ul class="li-head"></ul>');  
        }  
        var dataRoot = data.data;  
        if (pageTotal == 1) {     // 当只有一页时  
            for (var j = 0; j < totalCount; j++) {  
                $(".li-head").eq(j)
                .append('<li class="accountnum">'+dataRoot[j].accountNum+'</li>')  
                .append('<li class="accountalias">'+dataRoot[j].accountAlias+'</li>') 
                .append('<li class="displayname">'+dataRoot[j].displayName+'</li>')  
                .append('<li class="username">'+dataRoot[j].userName+'</li>')  
                .append('<li class="useremail">'+dataRoot[j].userTel+'</li>')  
                .append('<li class="description"><img src="image/bianji.png" class="sursors" alt=""></li>')             
            }  
           // $(".sursors") 
        } else {  
            for (var j = startPage, k = 0; j < endPage, k < pageSize; j++, k++) {  
                if( j == totalCount){  
                    break;       // 当遍历到最后一条记录时，跳出循环  
                }  
                $(".li-head").eq(k)
                 .append('<li class="accountnum">'+dataRoot[j].accountNum+'</li>')  
                .append('<li class="accountalias">'+dataRoot[j].accountAlias+'</li>') 
                .append('<li class="displayname">'+dataRoot[j].displayName+'</li>')  
                .append('<li class="username">'+dataRoot[j].userName+'</li>')  
                .append('<li class="useremail">'+dataRoot[j].userTel+'</li>')  
                .append('<li class="description"><img src="image/bianji.png" class="sursors" alt=""></li>')
            }  
        }  
        $(".page-count").text(pageTotal); 
       if (pageTotal == 1){

        var pagelength=$(".sursors").length;
          $('.sursors').click(function(){
          		$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/depts?token='+admin_token,function(data){
       		var departmentcount=data.data.length
       		html='';
       		for (var i = 0; i <departmentcount; i++) {
       			
       			html+='<option value="">'+data.data[i].departName+'</option>'
       		};
       		$('.department-input').append(html)
       	})
          	var i=$(this).parent().parent().index();
          	 $.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users?token='+admin_token, function(data) { 
          	 	var  userid=data.data[i].id;
          	 	var  dId=data.data[i].departId;
          	 	console.log(userid)
          	 	$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/depts/'+dId+'?token='+admin_token,function(data){
          	 		var ss=data.data.departName;
          	 		var ssparent=data.data.parentId;
          	 	$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users/'+userid+'?token='+admin_token,function(data){
          	 		var aA=data.data.accountAlias;
          	 		var dN=data.data.displayName;
          	 		var uN=data.data.userName;
          	 		var pw=data.data.password;
          	 		var ut=data.data.userTel;
          	 		var ue=data.data.userEmail
          	 		var descrip=data.data.description;
          	 		$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'?token='+admin_token,function(data){
          	 			var names=data.data.name
          	 			$(".lefts").html(aA)
	          	 		$(".lefts-right").val(dN)
	          	 		$(".editor-user").val(uN)
	          	 		$(".editor-password").val(pw)
	          	 		$(".lefts-department").html(names)
	          	 		$(".admin-tel").val(ut);
	          	 		$(".admin-email").val(ue)
	          	 		$(".description-input").val(descrip)
	          	 		for(var i=0;i<$("#sls option").length;i++) {  
				            if($("#sls option").eq(i).val() == ss) {   	
				                $("#sls option").eq(i).attr('selected',true);  
				                break;  
				            }  
				        } 
          	 		})
          	 })
			     	 	      $(".true").click(function(){
          	 	      		var valus=$('#sls option:selected') .val() 
          	 	      			$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/get-deptsbyname?token='+admin_token+'&departName='+valus,function(data){
					          	 		     
									
											        var dIds=data.data[0].id;  
													var disn=$(".lefts-right").val();
													var usen=$(".editor-user").val();
													var dest=$(".description-input").val()
													var admin_tel=$(".admin-tel").val();
													var admin_email=$(".admin-email").val()
													var admin_password=$(".editor-password").val()
													$.ajax({
														type:"put",
														dataType:"json",
														url:'https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users/'+userid+'?token='+admin_token+'&deptId='+dIds+'&displayName='+disn+'&userName='+usen+'&password='+admin_password+'&userEmail='+admin_email+'&userTel='+admin_tel+'&description='+dest,
														success:function(data){
															alert('编辑成功')
															$(".bcgs").hide();
															$(".forms").hide();
															location.reload() ;
														   }
													})
										
													})


									
          	 })



})

          	 $('.bcgs').show();
             $(".forms").show(); 
          })
         
        })
}
       else{
       		$('.sursors').click(function(){
       			// 获取部门的select
       				$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/depts?token='+admin_token,function(data){
       		var departmentcount=data.data.length
       		html='';
       		for (var i = 0; i <departmentcount; i++) {
       			
       			html+='<option value="'+data.data[i].departName+'">'+data.data[i].departName+'</option>'
       		};
       		$('.department-input').append(html)
       	})
          	var pagecount=($(".current-page").html()-1)*10;
          	var i=$(this).parent().parent().index()+pagecount;

          	 $.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users?token='+admin_token, function(data) { 
          	 	var  userid=data.data[i].id;
          	 	var  dId=data.data[i].departId;
          	 	
          	 	
          	 	$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/depts/'+dId+'?token='+admin_token,function(data){
          	 		var ss=data.data.departName;
          	 		var ssparent=data.data.parentId;
   										
         	 	
          	 	$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users/'+userid+'?token='+admin_token,function(data){
          	 		var aA=data.data.accountAlias;
          	 		var dN=data.data.displayName;
          	 		var uN=data.data.userName;
          	 		var pw=data.data.password;
          	 		var ut=data.data.userTel;
          	 		var ue=data.data.userEmail
          	 		var descrip=data.data.description;
          	 		$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'?token='+admin_token,function(data){
          	 			var names=data.data.name
          	 			$(".lefts").html(aA)
	          	 		$(".lefts-right").val(dN)
	          	 		$(".editor-user").val(uN)
	          	 		$(".editor-password").val(pw)
	          	 		$(".lefts-department").html(names)
	          	 		$(".admin-tel").val(ut);
	          	 		$(".admin-email").val(ue)
	          	 		$(".description-input").val(descrip)
	          	 		for(var i=0;i<$("#sls option").length;i++) {  
				            if($("#sls option").eq(i).val() == ss) {   	
				                $("#sls option").eq(i).attr('selected',true);  
				                break;  
				            }  
				        } 

          	 		})
          	 	})
          	 $(".true").click(function(){
          	 	var valus=$('#sls option:selected').val() 
          	 	alert(valus)
          	 	$.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/get-deptsbyname?token='+admin_token+'&departName='+valus,function(data){
          	 					dIds=data.data[0].id;
							    var disn=$(".lefts-right").val();
								var usen=$(".editor-user").val();
								var dest=$(".description-input").val()
								var admin_tel=$(".admin-tel").val();
								var admin_email=$(".admin-email").val()
								var admin_password=$(".editor-password").val()
								$.ajax({
									type:"put",
									dataType:"json",
									url:'https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users/'+userid+'?token='+admin_token+'&deptId='+dIds+'&displayName='+disn+'&userName='+usen+'&password='+admin_password+'&userEmail='+admin_email+'&userTel='+admin_tel+'&description='+dest,

									success:function(data){
										alert('编辑成功')
										$(".bcgs").hide();
										$(".forms").hide();
										location.reload() ;
									   }
								     })
						             
								}) 
	
          	               })	
          	 	     })

          	    })
          	 $('.bcgs').show();
             $(".forms").show(); 
          })
       }
    })  
  })
}  
function getPage() {  
    $.getJSON('https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users-count?token='+admin_token, function(data) {  
                pn = 1;  
                var totalCount = data.data.count; // 总记录数  
                var pageSize = 10; // 每页显示几条记录  
                var pageTotal = Math.ceil(totalCount / pageSize); // 总页数  
                $("#next").click(function() {  
                            if (pn == pageTotal) {  
                                alert("后面没有了");  
                                pn = pageTotal;  
                            } else {  
                                pn++;  
                                gotoPage(pn);  
                            }  
                        });  
                $("#prev").click(function() {  
                            if (pn == 1) {  
                                alert("前面没有了");  
                                pn = 1;  
                            } else {  
                                pn--;  
                                gotoPage(pn);  
                            }  
                        })  
                $("#firstPage").click(function() {  
                            pn = 1;  
                            gotoPage(pn);  
                        });  
                $("#lastPage").click(function() {  
                            pn = pageTotal;  
                            gotoPage(pn);  
                        });  
                $("#page-jump").click(function(){  
                    if($(".page-num").val()  <= pageTotal && $(".page-num").val() != ''){  
                        pn = $(".page-num").val();  
                        gotoPage(pn);  
                    }else{  
                        alert("您输入的页码有误！");  
                        $(".page-num").val('').focus();  
                    }  
                })  
                $("#firstPage").trigger("click");  
                  
            })  
}  
function gotoPage(pn) {  
    // alert(pn);  
    $(".current-page").text(pn);  
    getJSONData(pn)  
}  
function clicks(){
	$(".cancel").click(function(){
		$(".bcgs").hide();
		$(".forms").hide()
		location.reload();
	})
} 
// function sureclick(){
// 	$(".true").click(function(){
// 		alert(userid)
	// var data={
	// 	org_id:admin_id,
	// 	user_id:userid,
	// 	deptId:dId,
	// 	token:admin_token,
	// 	displayName:$(".lefts-right").val(),
	// 	userName:$(".editor-user").val(),
	// 	description:$(".description-input").val(),
	// }
	// $.ajax({
	// 	type:"put",
	// 	dataType:"json",
	// 	url:'https://api-test.cloudp.cc/cloudpServer/v1/orgs/'+admin_id+'/users/'+userid+'?token='+admin_token+'&deptId='+dId+'&displayName='+$(".lefts-right").val()+'&userName='+$(".editor-user").val()+'&description='+$(".description-input").val(),
	// 	success:function(data){
	// 		console.log(1)
	// 		$(".bcgs").hide();
	// 	}
	// })
// 	})
// }

$(function() {  
    getPage();  
    clicks()
})  
</script>
</body>
</html>